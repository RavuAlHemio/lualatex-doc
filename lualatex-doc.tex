\documentclass{lltxdoc}

\title{A guide to \lualatex}
\author{Manuel Pégourié-Gonnard \\ \email{mpg@elzevir.fr}}
\date{\today}

\begin{document}

\maketitle

\begin{abstract}
  This document guides the reader into the new world of
  \lualatex.\footnote{Though focusing on \lualatex, it includes relevant
    information about \luatex with the Plain format, too.} The intended
  audience ranges from complete newcomers (with a working knowledge of
  conventional \latex, though) to package developers. This guide is
  intended to be comprehensive in the following sense: it contains pointers to
  all relevant sources, gathers information that is otherwise scattered,
  and adds introductory material.

  Feedback, especially on the introduction, is most welcome.\footnote{The
    document is currently at an early stage of writing.  Thanks for your
    comprehension and patience.}
\end{abstract}

\setcounter{tocdepth}{2}
\tableofcontents
\clearpage

\section{Introduction}

\subsection{Just what is \lualatex?}

\subsection{Switching from \latex to \lualatex for the impatient}

\subsection{A Lua-in-\tex primer}

\subsection{Other things you should know}

\section{Essential packages}

This section presents the packages you'll probably want to always load as a
user, or that you should absolutely know about as a developer.

\subsection{User-level}

\subsubsection{Fontspec}

\pkgdesc{\WSPR}{\xetex, \luatex}{\latex}{%
  macros/latex/contrib/fontspec/}[https://github.com/wspr/fontspec/]
Nice interface to font management, well-integrated in to the \latex font
selection scheme. Already presented in the previous section.

\subsection{Developer-level}

\subsubsection{Engine detection: ifluatex, iftex, expl3}

Various packages allow to detect the engine currently processing the document.

\medskip
\pkgdesc[ifluatex]{\HO}{all}{atex, Plain}{%
  macros/latex/contrib/oberdiek/ifluatex.dtx}
Provides ©\ifluatex© and makes sure ©\luatexversion© is available.

\medskip
\pkgdesc[iftex]{\VK}{all}{atex, Plain}{%
  macros/latex/contrib/iftex}[http://bitbucket.org/vafa/iftex]
Provides ©\ifPDFTeX©, ©\ifXeTeX©, ©\ifLuaTeX© and corresponding ©\Require©
commands.

\medskip
\pkgdesc[expl3]{The \LaTeX3 Project}{all}{\latex}{%
  macros/latex/contrib/expl3}[http://www.latex-project.org/code.html]
Amongst \emph{many} other things, provides ©\luatex_if_engine:TF©,
©\xetex_if_engine:TF© and their variants.

\subsubsection{Mode detection: ifpdf}

\pkgdesc{\HO}{all}{atex, Plain}{%
  macros/latex/contrib/oberdiek/ifpdf.dtx}
Provides ©\ifpdf© switch. \luatex, like pdf\tex, can produce either PDF or DVI
output; the later is not very useful with \luatex as it doesn't support any
advanced feature such as Unicode and modern font formats. The ©\ifpdf© switch
tells you if you are running pdf\tex-or-\luatex in PDF mode (note that this
doesn't include \xetex).

\subsubsection{Luatexbase}

\pkgdesc{\ER \& \MPG}{\luatex}{atex, Plain}{%
  macros/luatex/generic/luatexbase}[https://github.com/mpg/luatexbase]
The Plain and \latex formats provide macros to manage \tex basic resources,
such as count or box registers. \luatex introduces new resources that need to
be shared gracefully by packages. This package provides the basic tools to
manage: the extended conventional \tex resources, catcode tables, attributes,
callbacks, Lua modules loading and identification. It also provides basic
tools to handle a few compatibility issues with older version of \luatex.

\textbf{Warning.} This package is currently in conflict with the \pf{luatex}
package, since they both do almost the same thing. The respective package
authors are well aware of this situation and plan to somehow merge the two
packages in the near future, though the timeline is not clear yet.

\subsubsection{Luatex}

\pkgdesc{\HO}{\luatex}{atex, Plain}{%
  macros/latex/contrib/oberdiek/luatex.dtx}
See the description of \pf{luatexbase} above. This package provides the same
core features except for callback management and Lua module identification.

\subsubsection{Font internals: luaotfload, euenc}\label{fontint}

Those packages are loaded by \pf{fontspec} to handle some low-level font and
encoding issues. A normal user should only use \pf{fontspec}, but a developer
may need to know about them.

\medskip
\pkgdesc[luaotfload]{\ER \& \KH}{\luatex}{atex, Plain}{%
  macros/luatex/generic/luaotfload/}[https://github.com/khaledhosny/luaotfload]
Low-level OpenType font loading. Basically, it uses the ©fontloader© Lua
library and the appropriate callbacks to implement a syntax for the ©\font©
primitive very similar to that of \xetex and implement the corresponding font
features. It also handles a font database for transparent access to fonts from
the system and the \tex distribution either by family name or by file name, as
well as a font cache for faster loading.

\medskip
\pkgdesc[euenc]{\WSPR, \ER \& \KH}{\xetex, \luatex}{\latex}{%
  macros/latex/contrib/euenc}[https://github.com/wspr/euenc]
Implements the ©EUx© Unicode font encodings for \latex's \pf{fontenc} system.
Currently, \xelatex is using ©EU1© and \luatex is using ©EU2©. Includes
definitions (©fd© files) for Latin Modern, the default font loaded by
\pf{fontspec}.

Also includes a stripped version of \pf{xunicode} so that the usual control
sequences for non-ASCII characters (such as ©\'e©) do the right thing.

\subsubsection{Lualibs}

\pkgdesc{\ER}{\luatex}{Lua}{%
  macros/luatex/generic/lualibs/}[https://github.com/mpg/lualibs]
Collection of Lua libraries and additions to the standard libraries; mostly
derived from the \context libraries. If you need a basic function that Lua
doesn't provide, check this package before rolling your own version.

\section{Other packages}

\subsection{User-level}

\subsubsection{Luatextra}

\pkgdesc{\MPG \& \ER}{\luatex}{\latex}{%
  macros/luatex/generic/luatextra/}[https://github.com/mpg/luatextra]
Loads various useful packages such as \pf{luatexbase}, \pf{luaotfload},
\pf{metalogo} (providing the ©\LuaTeX© and ©\LuaLaTeX© commands) and adds a
few goodies, such as a ©luacode© environment.

\subsubsection{Luainputenc}

\pkgdesc{\MPG \& \ER}{\luatex, \xetex, \pdftex}{\latex}{%
  macros/luatex/latex/luainputenc/}[https://github.com/mpg/luainputenc]
Helps compiling documents relying on legacy encodings (either in the source or
with the fonts). Already presented in the introduction. When running \xelatex,
just loads \pf{xetex-inputenc}; under pdf\latex, loads the standard
\pf{inputenc}.

\subsubsection{Luamplib}

\pkgdesc{\HH, \Taco \& \ER}{\luatex}{\latex, Plain}{%
  macros/luatex/generic/luamplib/}[https://github.com/mpg/luamplib]
Provides a nice interface for the ©mplib© Lua library that embeds metapost in
\luatex.

\subsubsection{Luacolor}

\subsubsection{Luadirections}

\subsection{Developer-level}

\subsubsection{Pdftexcmds}

\subsubsection{Magicnum}

\subsubsection{Lua-alt-getopt}

\section{The \luatex and \lualatex formats}

\section{Things that Just Work, partially work, or don't work (yet)}

\subsection{Just Working}

\subsection{Partially working}

Package \pf{microtype} has limited support for \luatex: mor precisely, as of
version 2.4 2010/01/10, protrusion and expansion are available and activated
by default in PDF mode, but kerning, spacing and tracking are not supported
(sse table~1 in section~3.1 of \file{microtype.pdf}).

On the other hand, \pf{luaotfload} (hence \pf{fontspec}) supports a lot of
microtypographic features. So the only problem is the lack of a unified
interface.

Package \pf{xunicode} would \emph{probably} work with \luatex, but explicitly
checks for \xetex only. Since \pf{euenc} (see~\ref{fontint}) includes a
modified version of this package, this should not be a problem.

\subsection{Not working (yet)}

\end{document}

% vim: set spell spelllang=en
